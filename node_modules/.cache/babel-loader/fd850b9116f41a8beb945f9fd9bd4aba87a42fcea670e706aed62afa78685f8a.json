{"ast":null,"code":"import \"core-js/modules/es.array.includes.js\";\nimport \"core-js/modules/es.string.includes.js\";\nimport \"core-js/modules/es.array.some.js\";\nimport \"core-js/modules/es.object.to-string.js\";\nimport \"core-js/modules/es.array.index-of.js\";\nimport \"core-js/modules/es.object.is.js\";\nimport \"core-js/modules/es.regexp.constructor.js\";\nimport \"core-js/modules/es.regexp.dot-all.js\";\nimport \"core-js/modules/es.regexp.exec.js\";\nimport \"core-js/modules/es.regexp.sticky.js\";\nimport \"core-js/modules/es.regexp.to-string.js\";\nimport \"core-js/modules/es.regexp.test.js\";\nimport { inject, computed, getCurrentInstance, toRaw, watch, unref } from 'vue';\nimport { get } from 'lodash-unified';\nimport '../../../utils/index.mjs';\nimport { selectKey, selectGroupKey } from './token.mjs';\nimport { isObject } from '@vue/shared';\nimport { escapeStringRegexp } from '../../../utils/strings.mjs';\nfunction useOption(props, states) {\n  var select = inject(selectKey);\n  var selectGroup = inject(selectGroupKey, {\n    disabled: false\n  });\n  var isObject$1 = computed(function () {\n    return isObject(props.value);\n  });\n  var itemSelected = computed(function () {\n    if (!select.props.multiple) {\n      return isEqual(props.value, select.props.modelValue);\n    } else {\n      return contains(select.props.modelValue, props.value);\n    }\n  });\n  var limitReached = computed(function () {\n    if (select.props.multiple) {\n      var modelValue = select.props.modelValue || [];\n      return !itemSelected.value && modelValue.length >= select.props.multipleLimit && select.props.multipleLimit > 0;\n    } else {\n      return false;\n    }\n  });\n  var currentLabel = computed(function () {\n    return props.label || (isObject$1.value ? \"\" : props.value);\n  });\n  var currentValue = computed(function () {\n    return props.value || props.label || \"\";\n  });\n  var isDisabled = computed(function () {\n    return props.disabled || states.groupDisabled || limitReached.value;\n  });\n  var instance = getCurrentInstance();\n  var contains = function contains() {\n    var arr = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : [];\n    var target = arguments.length > 1 ? arguments[1] : undefined;\n    if (!isObject$1.value) {\n      return arr && arr.includes(target);\n    } else {\n      var valueKey = select.props.valueKey;\n      return arr && arr.some(function (item) {\n        return toRaw(get(item, valueKey)) === get(target, valueKey);\n      });\n    }\n  };\n  var isEqual = function isEqual(a, b) {\n    if (!isObject$1.value) {\n      return a === b;\n    } else {\n      var valueKey = select.props.valueKey;\n      return get(a, valueKey) === get(b, valueKey);\n    }\n  };\n  var hoverItem = function hoverItem() {\n    if (!props.disabled && !selectGroup.disabled) {\n      select.hoverIndex = select.optionsArray.indexOf(instance.proxy);\n    }\n  };\n  watch(function () {\n    return currentLabel.value;\n  }, function () {\n    if (!props.created && !select.props.remote) select.setSelected();\n  });\n  watch(function () {\n    return props.value;\n  }, function (val, oldVal) {\n    var _select$props = select.props,\n      remote = _select$props.remote,\n      valueKey = _select$props.valueKey;\n    if (!Object.is(val, oldVal)) {\n      select.onOptionDestroy(oldVal, instance.proxy);\n      select.onOptionCreate(instance.proxy);\n    }\n    if (!props.created && !remote) {\n      if (valueKey && isObject(val) && isObject(oldVal) && val[valueKey] === oldVal[valueKey]) {\n        return;\n      }\n      select.setSelected();\n    }\n  });\n  watch(function () {\n    return selectGroup.disabled;\n  }, function () {\n    states.groupDisabled = selectGroup.disabled;\n  }, {\n    immediate: true\n  });\n  var _toRaw = toRaw(select),\n    queryChange = _toRaw.queryChange;\n  watch(queryChange, function (changes) {\n    var _unref = unref(changes),\n      query = _unref.query;\n    var regexp = new RegExp(escapeStringRegexp(query), \"i\");\n    states.visible = regexp.test(currentLabel.value) || props.created;\n    if (!states.visible) {\n      select.filteredOptionsCount--;\n    }\n  }, {\n    immediate: true\n  });\n  return {\n    select: select,\n    currentLabel: currentLabel,\n    currentValue: currentValue,\n    itemSelected: itemSelected,\n    isDisabled: isDisabled,\n    hoverItem: hoverItem\n  };\n}\nexport { useOption };","map":{"version":3,"names":["useOption","props","states","select","inject","selectKey","selectGroup","selectGroupKey","disabled","isObject$1","computed","isObject","value","itemSelected","multiple","isEqual","modelValue","contains","limitReached","length","multipleLimit","currentLabel","label","currentValue","isDisabled","groupDisabled","instance","getCurrentInstance","arr","arguments","undefined","target","includes","valueKey","some","item","toRaw","get","a","b","hoverItem","hoverIndex","optionsArray","indexOf","proxy","watch","created","remote","setSelected","val","oldVal","_select$props","Object","is","onOptionDestroy","onOptionCreate","immediate","_toRaw","queryChange","changes","_unref","unref","query","regexp","RegExp","escapeStringRegexp","visible","test","filteredOptionsCount"],"sources":["../../../../../../packages/components/select/src/useOption.ts"],"sourcesContent":["// @ts-nocheck\nimport { computed, getCurrentInstance, inject, toRaw, unref, watch } from 'vue'\nimport { get } from 'lodash-unified'\nimport { isObject as _isObject, escapeStringRegexp } from '@element-plus/utils'\nimport { selectGroupKey, selectKey } from './token'\n\nimport type { Ref } from 'vue'\nimport type { QueryChangeCtx } from './token'\n\nexport function useOption(props, states) {\n  // inject\n  const select = inject(selectKey)\n  const selectGroup = inject(selectGroupKey, { disabled: false })\n\n  // computed\n  const isObject = computed(() => _isObject(props.value))\n\n  const itemSelected = computed(() => {\n    if (!select.props.multiple) {\n      return isEqual(props.value, select.props.modelValue)\n    } else {\n      return contains(select.props.modelValue as unknown[], props.value)\n    }\n  })\n\n  const limitReached = computed(() => {\n    if (select.props.multiple) {\n      const modelValue = (select.props.modelValue || []) as unknown[]\n      return (\n        !itemSelected.value &&\n        modelValue.length >= select.props.multipleLimit &&\n        select.props.multipleLimit > 0\n      )\n    } else {\n      return false\n    }\n  })\n\n  const currentLabel = computed(() => {\n    return props.label || (isObject.value ? '' : props.value)\n  })\n\n  const currentValue = computed(() => {\n    return props.value || props.label || ''\n  })\n\n  const isDisabled = computed(() => {\n    return props.disabled || states.groupDisabled || limitReached.value\n  })\n\n  const instance = getCurrentInstance()\n\n  const contains = (arr = [], target) => {\n    if (!isObject.value) {\n      return arr && arr.includes(target)\n    } else {\n      const valueKey = select.props.valueKey\n      return (\n        arr &&\n        arr.some((item) => {\n          return toRaw(get(item, valueKey)) === get(target, valueKey)\n        })\n      )\n    }\n  }\n\n  const isEqual = (a: unknown, b: unknown) => {\n    if (!isObject.value) {\n      return a === b\n    } else {\n      const { valueKey } = select.props\n      return get(a, valueKey) === get(b, valueKey)\n    }\n  }\n\n  const hoverItem = () => {\n    if (!props.disabled && !selectGroup.disabled) {\n      select.hoverIndex = select.optionsArray.indexOf(instance.proxy)\n    }\n  }\n\n  watch(\n    () => currentLabel.value,\n    () => {\n      if (!props.created && !select.props.remote) select.setSelected()\n    }\n  )\n\n  watch(\n    () => props.value,\n    (val, oldVal) => {\n      const { remote, valueKey } = select.props\n\n      if (!Object.is(val, oldVal)) {\n        select.onOptionDestroy(oldVal, instance.proxy)\n        select.onOptionCreate(instance.proxy)\n      }\n\n      if (!props.created && !remote) {\n        if (\n          valueKey &&\n          _isObject(val) &&\n          _isObject(oldVal) &&\n          val[valueKey] === oldVal[valueKey]\n        ) {\n          return\n        }\n        select.setSelected()\n      }\n    }\n  )\n\n  watch(\n    () => selectGroup.disabled,\n    () => {\n      states.groupDisabled = selectGroup.disabled\n    },\n    { immediate: true }\n  )\n\n  const { queryChange } = toRaw(select)\n  watch(\n    queryChange,\n    (changes: Ref<QueryChangeCtx>) => {\n      const { query } = unref(changes)\n\n      const regexp = new RegExp(escapeStringRegexp(query), 'i')\n      states.visible = regexp.test(currentLabel.value) || props.created\n      if (!states.visible) {\n        select.filteredOptionsCount--\n      }\n    },\n    { immediate: true }\n  )\n\n  return {\n    select,\n    currentLabel,\n    currentValue,\n    itemSelected,\n    isDisabled,\n    hoverItem,\n  }\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}